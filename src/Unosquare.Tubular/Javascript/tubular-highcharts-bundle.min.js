"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="highcharts-ng"),function(){"use strict";function t(t,e,n){void 0===n&&(n=0),n<0&&(n+=t.length),n<0&&(n=0);for(var i=t.length;n<i;n++)if(n in t&&t[n]===e)return n;return-1}function e(t,e,n){var i=t[e];t[e]=function(){var t=Array.prototype.slice.call(arguments);return n.apply(this,t),i?i.apply(this,t):void 0}}function n(t,e){if(angular.isArray(e)){t=angular.isArray(t)?t:[];for(var i=0;i<e.length;i++)t[i]=n(t[i]||{},e[i])}else if(angular.isObject(e)){t=angular.isObject(t)?t:{};for(var r in e)t[r]=n(t[r]||{},e[r])}else t=e;return t}function i(t,e){function n(){return i}var i=t.when(e.Highcharts);return{getHighcharts:n,ready:function(t,e){n().then(function(){t.call(e)})}}}function r(i,r){function a(e,n,i,a){var o={},c=!1,h=function(e,i){var r,a=[];if(e){var u=s(e);if(u&&!n.disableDataWatch)return!1;if(angular.forEach(e,function(t,e){a.push(t.id);var n=c.get(t.id);if(n)if(angular.equals(o[t.id],d(t)))if(void 0!==t.visible&&n.visible!==t.visible&&n.setVisible(t.visible,!1),e<i.length){var r=i[e],s=angular.copy(r),u=t.data[t.data.length-1];s.data.push(u),angular.equals(s,t)?n.addPoint(u,!1):(s.data.shift(),angular.equals(s,t)?n.addPoint(u,!1,!0):n.setData(angular.copy(t.data),!1))}else n.setData(angular.copy(t.data),!1);else n.update(angular.copy(t),!1);else c.addSeries(angular.copy(t),!1);o[t.id]=d(t)}),n.config.noData){var h=!1;for(r=0;r<e.length;r++)if(e[r].data&&e[r].data.length>0){h=!0;break}h?c.hideLoading():c.showLoading(n.config.noData)}}for(r=c.series.length-1;r>=0;r--){var l=c.series[r];"highcharts-navigator-series"!==l.options.id&&t(a,l.options.id)<0&&l.remove(!1)}return!0},v=function(){c&&c.destroy(),o={};var t=n.config||{},r=l(n,i,t),a=t.func||void 0,s=p(n);c=new e[s](r,a);for(var h=0;h<u.length;h++)t[u[h]]&&f(c,t[u[h]],u[h]);t.loading&&c.showLoading(),t.getHighcharts=function(){return c}};v(),n.disableDataWatch?n.$watchCollection("config.series",function(t,e){h(t),c.redraw()}):n.$watch("config.series",function(t,e){var n=h(t,e);n&&c.redraw()},!0),n.$watch("config.title",function(t){c.setTitle(t,!0)},!0),n.$watch("config.subtitle",function(t){c.setTitle(!0,t)},!0),n.$watch("config.loading",function(t){t?c.showLoading(t===!0?null:t):c.hideLoading()}),n.$watch("config.noData",function(t){n.config&&n.config.loading&&c.showLoading(t)},!0),n.$watch("config.credits.enabled",function(t){t?c.credits.show():c.credits&&c.credits.hide()}),n.$watch(p,function(t,e){t!==e&&v()}),angular.forEach(u,function(t){n.$watch("config."+t,function(e){if(e){if(angular.isArray(e))for(var n=0;n<e.length;n++){var i=e[n];n<c[t].length&&(c[t][n].update(i,!1),g(c[t][n],angular.copy(i)))}else c[t][0].update(e,!1),g(c[t][0],angular.copy(e));c.redraw()}},!0)}),n.$watch("config.options",function(t,e,n){t!==e&&(v(),h(n.config.series),c.redraw())},!0),n.$watch("config.size",function(t,e){t!==e&&t&&c.setSize(t.width||c.chartWidth,t.height||c.chartHeight)},!0),n.$on("highchartsng.reflow",function(){c.reflow()}),n.$on("$destroy",function(){if(c){try{c.destroy()}catch(t){}r(function(){i.remove()},0)}})}function o(t,e,n){function r(i){a(i,t,e,n)}i.getHighcharts().then(r)}var c=0,s=function(t){var e=!1;return angular.forEach(t,function(t){angular.isDefined(t.id)||(t.id="series-"+c++,e=!0)}),e},u=["xAxis","yAxis"],h={stock:"StockChart",map:"Map",chart:"Chart"},l=function(t,i,a){var o={},c={chart:{events:{}},title:{},subtitle:{},series:[],credits:{},plotOptions:{},navigator:{enabled:!1},xAxis:{events:{}},yAxis:{events:{}}};return o=a.options?n(c,a.options):c,o.chart.renderTo=i[0],angular.forEach(u,function(i){angular.isDefined(a[i])&&(o[i]=n(o[i]||{},a[i]),(angular.isDefined(a[i].currentMin)||angular.isDefined(a[i].currentMax))&&(e(o.chart.events,"selection",function(e){var n=this;e[i]?t.$apply(function(){t.config[i].currentMin=e[i][0].min,t.config[i].currentMax=e[i][0].max}):t.$apply(function(){t.config[i].currentMin=n[i][0].dataMin,t.config[i].currentMax=n[i][0].dataMax})}),e(o.chart.events,"addSeries",function(e){t.config[i].currentMin=this[i][0].min||t.config[i].currentMin,t.config[i].currentMax=this[i][0].max||t.config[i].currentMax}),e(o[i].events,"setExtremes",function(e){e.trigger&&"zoom"!==e.trigger&&r(function(){t.config[i].currentMin=e.min,t.config[i].currentMax=e.max,t.config[i].min=e.min,t.config[i].max=e.max},0)})))}),a.title&&(o.title=a.title),a.subtitle&&(o.subtitle=a.subtitle),a.credits&&(o.credits=a.credits),a.size&&(a.size.width&&(o.chart.width=a.size.width),a.size.height&&(o.chart.height=a.size.height)),o},g=function(t,e){var n=t.getExtremes();e.currentMin===n.dataMin&&e.currentMax===n.dataMax||(t.setExtremes?t.setExtremes(e.currentMin,e.currentMax,!1):t.detachedsetExtremes(e.currentMin,e.currentMax,!1))},f=function(t,e,n){(e.currentMin||e.currentMax)&&t[n][0].setExtremes(e.currentMin,e.currentMax,!0)},d=function(t){return angular.extend(n({},t),{data:null,visible:null})},p=function(t){return void 0===t.config?"Chart":h[(""+t.config.chartType).toLowerCase()]||(t.config.useHighStocks?"StockChart":"Chart")};return{restrict:"EAC",replace:!0,template:"<div></div>",scope:{config:"=",disableDataWatch:"="},link:o}}angular.module("highcharts-ng",[]).factory("highchartsNG",["$q","$window",i]).directive("highchart",["highchartsNG","$timeout",r])}(),function(t){"use strict";t.module("tubular-hchart.directives",["tubular.services","highcharts-ng"]).component("tbHighcharts",{template:'<div class="tubular-chart"><highchart config="$ctrl.options" ng-hide="$ctrl.isEmpty || $ctrl.hasError"></highchart><div class="alert alert-info" ng-show="$ctrl.isEmpty">{{$ctrl.emptyMessage}}</div><div class="alert alert-warning" ng-show="$ctrl.hasError">{{$ctrl.errorMessage}}</div></div>',bindings:{serverUrl:"@",title:"@?",requireAuthentication:"=?",name:"@?chartName",chartType:"@?",emptyMessage:"@?",errorMessage:"@?",onLoad:"=?",options:"=?",onClick:"=?"},controller:["$scope","tubularHttp","$timeout",function(e,n,i){var r=this;r.dataService=n.getDataService(r.dataServiceName),r.showLegend=!!t.isUndefined(r.showLegend)||r.showLegend,r.chartType=r.chartType||"line",r.options=t.extend({},r.options,{options:{chart:{type:r.chartType},plotOptions:{pie:{point:{events:{click:r.onClick||t.noop}}},series:{point:{events:{click:r.onClick||t.noop}}}}},title:{text:r.title||""},xAxis:{categories:[]},yAxis:{},series:[]}),r.requireAuthentication=!!t.isUndefined(r.requireAuthentication)||r.requireAuthentication,r.loadData=function(){n.setRequireAuthentication(r.requireAuthentication),r.hasError=!1,n.get(r.serverUrl).promise.then(r.handleData,function(t){e.$emit("tbChart_OnConnectionError",t),r.hasError=!0})},r.handleData=function(t){if(!t||!t.Data||0===t.Data.length)return r.isEmpty=!0,r.options.series=[{data:[]}],void(r.onLoad&&r.onLoad(r.options,{}));if(r.isEmpty=!1,t.Series)r.options.xAxis.categories=t.Labels,r.options.series=t.Series.map(function(e,n){return{name:e,data:t.Data[n]}});else{var e=t.Labels.map(function(e,n){return{name:e,y:t.Data[n]}});r.options.series=[{name:t.SerieName||"",data:e,showInLegend:""!==(t.SerieName||"")}]}r.onLoad&&(i(function(){r.onLoad(r.options,{},r.options.getHighcharts().series)},100),r.onLoad(r.options,{},null))},e.$watch("$ctrl.serverUrl",function(e){t.isDefined(e)&&null!=e&&""!==e&&r.loadData()}),e.$watch("$ctrl.chartType",function(e){t.isDefined(e)&&null!=e&&(r.options.options.chart.type=e)})}]})}(angular);