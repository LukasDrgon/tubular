(function(n){"use strict";n.module("tubular-chart.directives",["tubular.services","chart.js"]).component("tbChartjs",{template:'<div class="tubular-chart"><canvas class="chart chart-base" chart-type="$ctrl.chartType" chart-data="$ctrl.data" chart-labels="$ctrl.labels"  chart-series="$ctrl.series" chart-click="$ctrl.onClick" chart-options="$ctrl.options"><\/canvas><ul ng-show="$ctrl.showLegend" class="pie-legend"><li ng-repeat="item in $ctrl.legends"><span style="background-color: {{item.color}}"><\/span>{{item.label}}<\/li><\/ul><div class="alert alert-info" ng-show="$ctrl.isEmpty">{{$ctrl.emptyMessage}}<\/div><div class="alert alert-warning" ng-show="$ctrl.hasError">{{$ctrl.errorMessage}}<\/div><\/div>',bindings:{serverUrl:"@",requireAuthentication:"=?",showLegend:"@?",name:"@?chartName",chartType:"@?",emptyMessage:"@?",errorMessage:"@?",onLoad:"=?",onClick:"=?",data:"=?",labels:"=?",series:"=?",options:"=?"},controller:["$scope","tubularHttp",function(t,i){var r=this;r.dataService=i.getDataService(r.dataServiceName);r.showLegend=n.isUndefined(r.showLegend)?!0:r.showLegend;r.chartType=r.chartType||"line";r.requireAuthentication=n.isUndefined(r.requireAuthentication)?!0:r.requireAuthentication;r.loadData=function(){i.setRequireAuthentication(r.requireAuthentication);i.get(r.serverUrl).promise.then(function(n){if(!n||!n.Data||n.Data.length===0){if(r.isEmpty=!0,r.options||(r.options={}),r.options.series=[{data:[]}],r.onLoad)r.onLoad(r.options,{});return}if(r.isEmpty=!1,r.data=n.Data,r.series=n.Series,r.labels=n.Labels,r.onLoad)r.onLoad(r.options,n)},function(n){t.$emit("tbChart_OnConnectionError",n)})};t.$watch("$ctrl.serverUrl",function(t){n.isDefined(t)&&t!=null&&r.loadData()});t.$on("chart-create",function(n,t){r.legends=r.chartType==="pie"||r.chartType==="doughnut"?t.chart.config.data.labels.map(function(n,i){return{label:n,color:t.chart.config.data.datasets[0].backgroundColor[i]}}):t.chart.config.data.datasets.map(function(n){return{label:n.label,color:n.borderColor}})})}]})})(angular);