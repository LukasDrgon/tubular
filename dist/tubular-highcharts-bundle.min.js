(function(n){"use strict";n.module("tubular-hchart.directives",["tubular.services","highcharts-ng"]).component("tbHighcharts",{template:'<div class="tubular-chart"><highchart config="$ctrl.options" ng-hide="$ctrl.isEmpty || $ctrl.hasError"><\/highchart><div class="alert alert-info" ng-show="$ctrl.isEmpty">{{$ctrl.emptyMessage}}<\/div><div class="alert alert-warning" ng-show="$ctrl.hasError">{{$ctrl.errorMessage}}<\/div><\/div>',bindings:{serverUrl:"@",title:"@?",requireAuthentication:"=?",name:"@?chartName",chartType:"@?",emptyMessage:"@?",errorMessage:"@?",onLoad:"=?",options:"=?",onClick:"=?"},controller:["$scope","tubularHttp","$timeout",function(t,i,r){var u=this;u.dataService=i.getDataService(u.dataServiceName);u.showLegend=n.isUndefined(u.showLegend)?!0:u.showLegend;u.chartType=u.chartType||"line";u.options=n.extend({},u.options,{options:{chart:{type:u.chartType},plotOptions:{pie:{point:{events:{click:u.onClick||n.noop}}},series:{point:{events:{click:u.onClick||n.noop}}}}},title:{text:u.title||""},xAxis:{categories:[]},yAxis:{},series:[]});u.requireAuthentication=n.isUndefined(u.requireAuthentication)?!0:u.requireAuthentication;u.loadData=function(){i.setRequireAuthentication(u.requireAuthentication);u.hasError=!1;i.get(u.serverUrl).promise.then(function(n){if(!n||!n.Data||n.Data.length===0){if(u.isEmpty=!0,u.options.series=[{data:[]}],u.onLoad)u.onLoad(u.options,{});return}if(u.isEmpty=!1,n.Series)u.options.xAxis.categories=n.Labels,u.options.series=n.Series.map(function(t,i){return{name:t,data:n.Data[i]}});else{var t=n.Labels.map(function(t,i){return{name:t,y:n.Data[i]}});u.options.series=[{name:n.SerieName||"",data:t,showInLegend:(n.SerieName||"")!==""}]}if(u.onLoad){r(function(){u.onLoad(u.options,{},u.options.getHighcharts().series)},100);u.onLoad(u.options,{},null)}},function(n){t.$emit("tbChart_OnConnectionError",n);u.hasError=!0})};t.$watch("$ctrl.serverUrl",function(t){n.isDefined(t)&&t!=null&&t!==""&&u.loadData()});t.$watch("$ctrl.chartType",function(t){n.isDefined(t)&&t!=null&&(u.options.options.chart.type=t)})}]})})(angular);